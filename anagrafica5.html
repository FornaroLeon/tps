<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <title>Anagrafica con Validazione Regex</title>
  <style>
    .error { color: red; font-size: 0.85em; display: block; margin-bottom: 5px; }
    input { margin-bottom: 10px; }
  </style>
</head>
<body>

  <h1>Gestione Dati Personali</h1>

  <form id="formDati">
    Nome: <input type="text" id="nome" required> <span id="errNome" class="error"></span>
    Cognome: <input type="text" id="cognome" required> <span id="errCognome" class="error"></span>
    Età: <input type="number" id="eta" required><br>
    CAP: <input type="text" id="cap" required> <span id="errCap" class="error"></span>
    Professione: <input type="text" id="professione" required><br>
    Email: <input type="text" id="email" required> <span id="errEmail" class="error"></span>
    <button type="submit">Salva</button>
  </form>

  <hr>
  <table border="1" width="100%">
    <thead>
      <tr>
        <th>Nome</th><th>Cognome</th><th>Età</th><th>CAP</th><th>Professione</th><th>Email</th>
      </tr>
    </thead>
    <tbody id="tabellaDati"></tbody>
  </table>

  <script>
    const form = document.getElementById('formDati');
    const elenco = JSON.parse(localStorage.getItem('elenco')) || [];

    // --- ESPRESSIONI REGOLARI ---
    const regexLettere = /^[A-Za-zÀ-ÿ\s]+$/; // Solo lettere e spazi
    const regexCap = /^\d+$/;                // Solo numeri
    const regexEmail = /^[^\s@]+@[^\s@]+\.[a-zA-Z]{2,6}$/; // Email con @, . e estensione 2-6

    form.addEventListener('submit', function(e) {
      e.preventDefault();
      
      // Reset messaggi errore
      document.querySelectorAll('.error').forEach(s => s.textContent = "");

      const dati = {
        nome: document.getElementById('nome').value.trim(),
        cognome: document.getElementById('cognome').value.trim(),
        eta: document.getElementById('eta').value,
        cap: document.getElementById('cap').value.trim(),
        professione: document.getElementById('professione').value,
        email: document.getElementById('email').value.trim()
      };

      let valido = true;

      // Validazione Nome e Cognome
      if (!regexLettere.test(dati.nome)) { 
        document.getElementById('errNome').textContent = "Usa solo lettere"; 
        valido = false; 
      }
      if (!regexLettere.test(dati.cognome)) { 
        document.getElementById('errCognome').textContent = "Usa solo lettere"; 
        valido = false; 
      }
      
      // Validazione CAP (solo numeri)
      if (!regexCap.test(dati.cap)) { 
        document.getElementById('errCap').textContent = "Il CAP deve contenere solo numeri"; 
        valido = false; 
      }

      // Validazione Email
      if (!regexEmail.test(dati.email)) { 
        document.getElementById('errEmail').textContent = "Email non valida (es: nome@dominio.it)"; 
        valido = false; 
      }

      if (valido) {
        elenco.push(dati);
        localStorage.setItem('elenco', JSON.stringify(elenco));
        form.reset();
        mostraDati();
      }
    });

    function mostraDati() {
      const tabella = document.getElementById('tabellaDati');
      tabella.innerHTML = elenco.map(p => `
        <tr>
          <td>${p.nome}</td><td>${p.cognome}</td><td>${p.eta}</td>
          <td>${p.cap}</td><td>${p.professione}</td><td>${p.email}</td>
        </tr>`).join('');
    }

    mostraDati();
  </script>
</body>
</html>
